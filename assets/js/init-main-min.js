!function(){"use strict";function s(){const e=document.createElement("input");e.type="file",e.accept=".json",e.addEventListener("change",function(){var t=new FileReader;t.onload=function(t){var e=t.target;try{var s=JSON.parse(e.result);"unlocked"in s&&"qp"in s&&"complete"in s&&(r=s,h.updateAllSections(),f(),localStorage.setObject(i,r))}catch(t){console.error(t)}},t.readAsText(e.files[0])},!1);var t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});e.dispatchEvent(t),e.remove()}Storage.prototype.setObject=function(t,e){this.setItem(t,JSON.stringify(e))},Storage.prototype.getObject=function(t){t=this.getItem(t);return t&&JSON.parse(t)};const i="osrs-xosaat-user-v2";let r={combat:!1,unlocked:[],qp:0,complete:{quests:[],achievements:[],pets:[],collections:{}},showHide:{collections:"show",pets:"show",quests:"show",achievements:"show"}};null!==localStorage.getItem(i)?r=localStorage.getObject(i):localStorage.setObject(i,r);const o=Object.freeze({Easy:1,Medium:2,Hard:3,Elite:4}),l="/osrs-progress/assets",c="https://oldschool.runescape.wiki/images/",n=new JSConfetti;let a;const d="#skills-wrapper .skill-item",e="#skills-progress",p="#qp-progress",u=".show-hide",m=".modal-body li",h={init:function(){for(var t in this)"object"==typeof this[t]&&(this[t].parent=this);return this},achievements:{type:"achievements",dir:l+"/json/achievements.json",selectors:{wrapper:"#achievements-wrapper",items:"#achievements-wrapper .json-item",completed:"#achievements-completed",total:"#achievements-total",progress:"#achievements-progress"},data:{},buildNode:function(t){return`<div class="col ${t.classes.hidden}">
                            <div class="d-flex flex-column json-item h-100 p-3 rounded ${t.classes.complete}" data-src="achievements">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h4>${t.data.diary}</h4>
                                    <span class="difficulty-${t.data.difficulty}">${t.data.difficulty}</span>
                                </div>
                                <hr/>
                                <div class="flex-grow-1">
                                    <span class="json-description">${t.data.task}</span>
                                </div>
                                <hr/>
                                <span class="text-muted"></span>
                            </div>
                        </div>`},update:function(){this.parent.updateSection(this.type,this.selectors)}},quests:{type:"quests",dir:l+"/json/quests.json",selectors:{wrapper:"#quests-wrapper",items:"#quests-wrapper .json-item",completed:"#quests-completed",total:"#quests-total",progress:"#quests-progress"},data:{},buildNode:function(t){return`<div class="col ${t.classes.hidden}">
                            <div class="json-item h-100 p-3 rounded ${t.classes.complete}" data-src="quests">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h4>${t.title}</h4>
                                    <span class="difficulty-${t.data.difficulty}">${t.data.difficulty}</span>
                                </div>
                                <hr/>
                                <span class="text-muted"></span>
                            </div>
                        </div>`},update:function(){this.parent.updateSection(this.type,this.selectors)}},pets:{type:"pets",dir:l+"/json/pets.json",selectors:{wrapper:"#pets-wrapper",items:"#pets-wrapper .json-item",completed:"#pets-completed",total:"#pets-total",progress:"#pets-progress"},data:{},buildNode:function(t){return`<div class="col ${t.classes.hidden}">
                            <div class="json-item h-100 p-3 rounded ${t.classes.complete}" data-src="pets">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h4>${t.title}</h4>
                                    <img src="${t.data.img}" alt="${t.title} icon"/>
                                </div>
                                <hr/>
                                <span class="text-muted"></span>
                            </div>
                        </div>`},update:function(){this.parent.updateSection(this.type,this.selectors)}},collections:{type:"collections",dir:l+"/json/collections.json",selectors:{wrapper:"#collections-wrapper",items:"#collections-wrapper .json-item",completed:"#collections-completed",total:"#collections-total",progress:"#collections-progress"},data:{},buildNode:function(e){var s=e.data.items.length;let i=`<div class="col col-sm-12 col-md-6 col-lg-4 ${e.classes.hidden}">
                                <div class="d-flex flex-column json-item p-3 rounded ${e.classes.complete}" data-src="collections">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <h4>${e.title}</h4>
                                        <img src="${e.data.img}" alt="${e.title} icon"/>
                                    </div>
                                    <hr/>
                                    <ul class="d-flex flex-wrap gap-2 py-2">`;for(let t=0;t<Math.min(5,s);t++){var o=e.title in r.complete.collections&&r.complete.collections[e.title].includes(e.data.items[t])?"complete":"";i+=`<li class="list-group-item rounded ${o}">${e.data.items[t]}</li>`}return i+="</ul>",5<s&&(i+=`<span>and ${s-5} others...</span>`),i+=`<hr/>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted"></span>
                            <div class="justify-content-end">
                                <span>${e.title in r.complete.collections?r.complete.collections[e.title].length:0}/${s}</span>
                            </div>
                        </div>
                    </div>
                </div>`},buildModal:function(t){let e="";for(const i of this.data[t].items){var s=t in r.complete.collections&&r.complete.collections[t].includes(i)?"complete":"";e+=`<li class="list-group-item rounded d-flex justify-content-between ${s}">
                        <div class="d-flex justify-content-start align-items-center">
                            <img src="${c}${i.replaceAll(" ","_")}.png" onerror="this.src='${c}Bank_filler.png'" width="16px" height="16px" alt="icon"/>
                            <span class="collection-item ms-3">${i}</span>
                        </div>
                        <span class="text-muted"></span>
                    </li>`}$(".modal-title").text(t),$(".modal-body ul").html(e),$(m).on("click",j)},update:function(){this.parent.updateSection(this.type,this.selectors),v()}},updateSection:function(t,e){$(e.wrapper).html(this.buildNodes(t));var t=$(e.items).length,s=$(e.items+".complete").length,i=Math.round(s/t*100)||0;$(e.total).text(t),$(e.completed).text(s),$(e.progress).width(i+"%"),$(e.progress).text(i+"%"),$(e.items).on("click",y)},updateAllSections:function(){this.achievements.update(),this.quests.update(),this.pets.update(),this.collections.update()},buildNodes:function(e){var s="hide"===r.showHide[e],i=[],o=[];for(const a in this[e].data){var l=this[e].data[a];if(e===this.quests.type&&0<l.rewards.skills.length&&(c=new Set(l.requirements.skills.concat(l.rewards.skills)),l.requirements.skills=Array.from(c)),function(t){if(t){if("combat"in t&&t.combat&&!r.combat)return;if("quests"in t)for(const e of t.quests)if(!r.complete.quests.includes(e))return;if("skills"in t)for(const s of t.skills)if(!r.unlocked.includes(s))return;if("qp"in t&&r.qp<t.qp)return}return 1}(l.requirements)){let t;var c=(t=e===this.collections.type?a in r.complete.collections&&r.complete.collections[a].length===l.items.length:r.complete[e].includes(e===this.achievements.type?l.task:a))?"complete":"",n=t&&s?"d-none":"",n=this[e].buildNode({data:l,title:a,classes:{hidden:n,complete:c}}),l=e===this.achievements.type?{diary:l.diary,difficulty:l.difficulty,html:n}:{name:a,html:n};(t?o:i).push(l)}}return this.sortNodes(e,i)+this.sortNodes(e,o)},sortNodes:function(t,e){let s="";t===this.achievements.type?e.sort((t,e)=>t.diary.localeCompare(e.diary)||o[t.difficulty]-o[e.difficulty]):e.sort((t,e)=>t.name.localeCompare(e.name));for(const i of e)s+=i.html;return s}}.init();function f(){$(d+".unlocked").removeClass("unlocked");for(const t of r.unlocked)$(".skill-item[data-src="+t+"]").addClass("unlocked");$(p).text(r.qp),$(e).text(r.unlocked.length)}function v(){$(h.collections.selectors.wrapper).masonry("reloadItems"),$(h.collections.selectors.wrapper).masonry("layout")}function g(t,e){t.includes(e)?t.splice(t.indexOf(e),1):t.push(e)}function w(){var t=$(".skill-title",this).text().trim();$(this).toggleClass("unlocked"),"Combat"===t?r.combat=!r.combat:g(r.unlocked,t),h.updateAllSections(),$(e).text(r.unlocked.length),localStorage.setObject(i,r)}function y(){var t,e=$(this).attr("data-src");e===h.collections.type?(h.collections.buildModal($("h4",this).text().trim()),a.show()):($(this).toggleClass("complete"),e===h.achievements.type?g(r.complete[e],$(".json-description",this).text().trim()):(t=$("h4",this).text().trim(),g(r.complete[e],t),e===h.quests.type&&($(this).hasClass("complete")?r.qp=r.qp+h.quests.data[t].rewards.qp:r.qp=r.qp-h.quests.data[t].rewards.qp,$(p).text(r.qp),h.achievements.update(),h.pets.update(),h.collections.update())),h[e].update(),localStorage.setObject(i,r),$(this).hasClass("complete")&&n.addConfetti())}function b(){var t=$(this).attr("data-src").split(","),e=t[0],t="hide"===t[1]?"show":"hide";$(this).attr("data-src",e+","+t),$(this).attr("src",l+`/images/svg/${t}.svg`),$(h[e].selectors.items+".complete").parent().toggleClass("d-none"),e===h.collections.type&&v(),r.showHide[e]=t,localStorage.setObject(i,r)}function j(){$(this).toggleClass("complete")}function x(){var t=$(m+".complete").length,e=$(".modal-title").text();const s=[];$(m+".complete").each(function(){s.push($(".collection-item",this).text())}),r.complete.collections[e]=s,h.collections.update(),t===h.collections.data[e].items.length&&n.addConfetti(),a.hide(),localStorage.setObject(i,r)}function k(){$(m).addClass("complete")}$(document).ready(function(){a=new bootstrap.Modal($(".modal")[0]),$(d).on("click",w),$(u).on("click",b),$("#btn-upload").on("click",s),$("#btn-download").on("click",function(){var t,e,s;t="data.json",e=r,e=new Blob([JSON.stringify(e)],{type:"text/json"}),(s=document.createElement("a")).download=t,s.href=window.URL.createObjectURL(e),s.dataset.downloadurl=["text/json",s.download,s.href].join(":"),t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}),s.dispatchEvent(t),s.remove()}),$("#btn-modal-complete-all").on("click",k),$("#btn-modal-save").on("click",x),$(u).each(function(){var t=$(this).attr("data-src").split(",")[0];$(this).attr("data-src",t+","+r.showHide[t]),$(this).attr("src",l+`/images/svg/${r.showHide[t]}.svg`)});for(const e in h){var t=h[e];$.getJSON(t.dir,function(t){this.data=t,this.update()}.bind(t))}f()})}();