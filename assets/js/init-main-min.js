!function(){"use strict";function s(){const t=document.createElement("input");t.type="file",t.accept=".json",t.addEventListener("change",function(){var e=new FileReader;e.onload=function(e){var t=e.target;try{var s=JSON.parse(t.result);"unlocked"in s&&"qp"in s&&"complete"in s&&(r=s,h.updateAllSections(),f(),localStorage.setObject(i,r))}catch(e){console.error(e)}},e.readAsText(t.files[0])},!1);var e=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});t.dispatchEvent(e),t.remove()}Storage.prototype.setObject=function(e,t){this.setItem(e,JSON.stringify(t))},Storage.prototype.getObject=function(e){e=this.getItem(e);return e&&JSON.parse(e)};const i="osrs-xosaat-user-v2";let r={combat:!1,unlocked:[],qp:0,complete:{quests:[],achievements:[],pets:[],collections:{}},showHide:{collections:"show",pets:"show",quests:"show",achievements:"show"}};null!==localStorage.getItem(i)?r=localStorage.getObject(i):localStorage.setObject(i,r);const o=Object.freeze({Easy:1,Medium:2,Hard:3,Elite:4}),l="/osrs-progress/assets",c="https://oldschool.runescape.wiki/images/",n=new JSConfetti;let a;const d="#skills-wrapper .skill-item",t="#skills-progress",p="#qp-progress",u=".show-hide",m=".modal-body li",h={init:function(){for(var e in this)"object"==typeof this[e]&&(this[e].parent=this);return this},achievements:{type:"achievements",dir:l+"/json/achievements.json",selectors:{wrapper:"#achievements-wrapper",items:"#achievements-wrapper .json-item",completed:".achievements-completed",total:".achievements-total",incomplete:".achievements-incomplete",progress:"#achievements-progress"},data:{},buildNode:function(e){return`<div class="col ${e.classes.hidden}">
                            <div class="d-flex flex-column json-item h-100 p-3 rounded ${e.classes.complete}" data-src="achievements">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h4>${e.data.diary}</h4>
                                    <span class="difficulty-${e.data.difficulty}">${e.data.difficulty}</span>
                                </div>
                                <hr/>
                                <div class="flex-grow-1">
                                    <span class="json-description">${e.data.task}</span>
                                </div>
                                <hr/>
                                <span class="text-muted"></span>
                            </div>
                        </div>`},update:function(){this.parent.updateSection(this.type,this.selectors)}},quests:{type:"quests",dir:l+"/json/quests.json",selectors:{wrapper:"#quests-wrapper",items:"#quests-wrapper .json-item",completed:".quests-completed",total:".quests-total",incomplete:".quests-incomplete",progress:"#quests-progress"},data:{},buildNode:function(e){return`<div class="col ${e.classes.hidden}">
                            <div class="json-item h-100 p-3 rounded ${e.classes.complete}" data-src="quests">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h4>${e.title}</h4>
                                    <span class="difficulty-${e.data.difficulty}">${e.data.difficulty}</span>
                                </div>
                                <hr/>
                                <span class="text-muted"></span>
                            </div>
                        </div>`},update:function(){this.parent.updateSection(this.type,this.selectors)}},pets:{type:"pets",dir:l+"/json/pets.json",selectors:{wrapper:"#pets-wrapper",items:"#pets-wrapper .json-item",completed:".pets-completed",total:".pets-total",incomplete:".pets-incomplete",progress:"#pets-progress"},data:{},buildNode:function(e){return`<div class="col ${e.classes.hidden}">
                            <div class="json-item h-100 p-3 rounded ${e.classes.complete}" data-src="pets">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h4>${e.title}</h4>
                                    <img src="${e.data.img}" alt="${e.title} icon"/>
                                </div>
                                <hr/>
                                <span class="text-muted"></span>
                            </div>
                        </div>`},update:function(){this.parent.updateSection(this.type,this.selectors)}},collections:{type:"collections",dir:l+"/json/collections.json",selectors:{wrapper:"#collections-wrapper",items:"#collections-wrapper .json-item",completed:".collections-completed",total:".collections-total",incomplete:".collections-incomplete",progress:"#collections-progress"},data:{},buildNode:function(t){var s=t.data.items.length;let i=`<div class="col col-sm-12 col-md-6 col-lg-4 ${t.classes.hidden}">
                                <div class="d-flex flex-column json-item p-3 rounded ${t.classes.complete}" data-src="collections">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <h4>${t.title}</h4>
                                        <img src="${t.data.img}" alt="${t.title} icon"/>
                                    </div>
                                    <hr/>
                                    <ul class="d-flex flex-wrap gap-2 py-2">`;for(let e=0;e<Math.min(5,s);e++){var o=t.title in r.complete.collections&&r.complete.collections[t.title].includes(t.data.items[e])?"complete":"";i+=`<li class="list-group-item rounded ${o}">${t.data.items[e]}</li>`}return i+="</ul>",5<s&&(i+=`<span>and ${s-5} others...</span>`),i+=`<hr/>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted"></span>
                            <div class="justify-content-end">
                                <span>${t.title in r.complete.collections?r.complete.collections[t.title].length:0}/${s}</span>
                            </div>
                        </div>
                    </div>
                </div>`},buildModal:function(e){let t="";for(const i of this.data[e].items){var s=e in r.complete.collections&&r.complete.collections[e].includes(i)?"complete":"";t+=`<li class="list-group-item rounded d-flex justify-content-between ${s}">
                        <div class="d-flex justify-content-start align-items-center">
                            <img src="${c}${i.replaceAll(" ","_")}.png" onerror="this.src='${c}Bank_filler.png'" width="16px" height="16px" alt="icon"/>
                            <span class="collection-item ms-3">${i}</span>
                        </div>
                        <span class="text-muted"></span>
                    </li>`}$(".modal-title").text(e),$(".modal-body ul").html(t),$(m).on("click",j)},update:function(){this.parent.updateSection(this.type,this.selectors),v()}},updateSection:function(e,t){$(t.wrapper).html(this.buildNodes(e));var e=$(t.items).length,s=$(t.items+".complete").length,i=Math.round(s/e*100)||0,o=e-s;$(t.total).text(e),$(t.completed).text(s),$(t.incomplete).text(o),$(t.progress).width(i+"%"),$(t.progress).text(i+"%"),$(t.items).on("click",y)},updateAllSections:function(){this.achievements.update(),this.quests.update(),this.pets.update(),this.collections.update()},buildNodes:function(t){var s="hide"===r.showHide[t],i=[],o=[];for(const a in this[t].data){var l=this[t].data[a];if(t===this.quests.type&&0<l.rewards.skills.length&&(c=new Set(l.requirements.skills.concat(l.rewards.skills)),l.requirements.skills=Array.from(c)),function(e){if(e){if("combat"in e&&e.combat&&!r.combat)return;if("quests"in e)for(const t of e.quests)if(!r.complete.quests.includes(t))return;if("skills"in e)for(const s of e.skills)if(!r.unlocked.includes(s))return;if("qp"in e&&r.qp<e.qp)return}return 1}(l.requirements)){let e;var c=(e=t===this.collections.type?a in r.complete.collections&&r.complete.collections[a].length===l.items.length:r.complete[t].includes(t===this.achievements.type?l.task:a))?"complete":"",n=e&&s?"d-none":"",n=this[t].buildNode({data:l,title:a,classes:{hidden:n,complete:c}}),l=t===this.achievements.type?{diary:l.diary,difficulty:l.difficulty,html:n}:{name:a,html:n};(e?o:i).push(l)}}return this.sortNodes(t,i)+this.sortNodes(t,o)},sortNodes:function(e,t){let s="";e===this.achievements.type?t.sort((e,t)=>e.diary.localeCompare(t.diary)||o[e.difficulty]-o[t.difficulty]):t.sort((e,t)=>e.name.localeCompare(t.name));for(const i of t)s+=i.html;return s}}.init();function f(){$(d+".unlocked").removeClass("unlocked");for(const e of r.unlocked)$(".skill-item[data-src="+e+"]").addClass("unlocked");$(p).text(r.qp),$(t).text(r.unlocked.length)}function v(){$(h.collections.selectors.wrapper).masonry("reloadItems"),$(h.collections.selectors.wrapper).masonry("layout")}function g(e,t){e.includes(t)?e.splice(e.indexOf(t),1):e.push(t)}function w(){var e=$(".skill-title",this).text().trim();$(this).toggleClass("unlocked"),"Combat"===e?r.combat=!r.combat:g(r.unlocked,e),h.updateAllSections(),$(t).text(r.unlocked.length),localStorage.setObject(i,r)}function y(){var e,t=$(this).attr("data-src");t===h.collections.type?(h.collections.buildModal($("h4",this).text().trim()),a.show()):($(this).toggleClass("complete"),t===h.achievements.type?g(r.complete[t],$(".json-description",this).text().trim()):(e=$("h4",this).text().trim(),g(r.complete[t],e),t===h.quests.type&&($(this).hasClass("complete")?r.qp=r.qp+h.quests.data[e].rewards.qp:r.qp=r.qp-h.quests.data[e].rewards.qp,$(p).text(r.qp),h.achievements.update(),h.pets.update(),h.collections.update())),h[t].update(),localStorage.setObject(i,r),$(this).hasClass("complete")&&n.addConfetti())}function b(){var e=$(this).attr("data-src").split(","),t=e[0],e="hide"===e[1]?"show":"hide";$(this).attr("data-src",t+","+e),$(this).attr("src",l+`/images/svg/${e}.svg`),$(h[t].selectors.items+".complete").parent().toggleClass("d-none"),t===h.collections.type&&v(),r.showHide[t]=e,localStorage.setObject(i,r)}function j(){$(this).toggleClass("complete")}function x(){var e=$(m+".complete").length,t=$(".modal-title").text();const s=[];$(m+".complete").each(function(){s.push($(".collection-item",this).text())}),r.complete.collections[t]=s,h.collections.update(),e===h.collections.data[t].items.length&&n.addConfetti(),a.hide(),localStorage.setObject(i,r)}function q(){$(m).addClass("complete")}$(document).ready(function(){a=new bootstrap.Modal($(".modal")[0]),$(d).on("click",w),$(u).on("click",b),$("#btn-upload").on("click",s),$("#btn-download").on("click",function(){var e,t,s;e="data.json",t=r,t=new Blob([JSON.stringify(t)],{type:"text/json"}),(s=document.createElement("a")).download=e,s.href=window.URL.createObjectURL(t),s.dataset.downloadurl=["text/json",s.download,s.href].join(":"),e=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}),s.dispatchEvent(e),s.remove()}),$("#btn-modal-complete-all").on("click",q),$("#btn-modal-save").on("click",x),$(u).each(function(){var e=$(this).attr("data-src").split(",")[0];$(this).attr("data-src",e+","+r.showHide[e]),$(this).attr("src",l+`/images/svg/${r.showHide[e]}.svg`)});for(const t in h){var e=h[t];$.getJSON(e.dir,function(e){this.data=e,this.update()}.bind(e))}f()})}();